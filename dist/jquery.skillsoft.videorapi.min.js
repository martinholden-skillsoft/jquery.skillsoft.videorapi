/*! jQuery Skillsoft Video Restful API Plugin - v1.0.0 - 2018-05-10
* https://github.com/martinholden-skillsoft/jquery.skillsoft.videorapi
* Copyright (c) 2018 Martin Holden; Licensed MIT */
!function(a,b,c,d,e,f){"use strict";var g,h,i,j,k,l,m,n,o="1.0.0";Object.keys||(Object.keys=function(a){var b,c=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&c.push(b);return c}),i=function(a,b){return function(){return a.apply(b,arguments)}},j=function(a,b,c,d){d.resolve(a,b,c)},k=function(a,b,c,d){try{var e=JSON.parse(a.responseText);"errorCode"in e?d.reject(a,b,c,e.errorCode):d.reject(a,b,c)}catch(f){d.reject(a,b,c)}},l=function(a){return"undefined"==typeof a||null===a},m=function(a){if("undefined"==typeof a)throw new Error("options is undefined");if(l(a.hostname))throw new Error("hostname is a required option");if(l(a.HashkeyProxy)&&l(a.sharedsecret))throw new Error("sharedsecret or HashkeyProxy is a required option")},h={hostname:f,sharedsecret:f,HashkeyProxy:f,RAPIVersion:"v3",loginpath:"/skillportfe/rapi/video/authSharedSecret/login",logoutpath:"/skillportfe/rapi/video/authSharedSecret/logout",videodetailspath:"/skillportfe/rapi/video/video/{{videoid}}/details",videocontentlocationpath:"/skillportfe/rapi/video/video/{{videoid}}/contentLocation"},g=function(){function c(b){n=this,this.options={},a.extend(!0,this.options,h,b),Object.keys(b).length>0&&m(n.options),this.update=i(this.update,this),this.login=i(this.login,this),this.logout=i(this.logout,this),this.videoDetails=i(this.videoDetails,this),this.videoContentLocation=i(this.videoContentLocation,this),this.getVersion=i(this.getVersion,this)}return c.prototype.update=function(b){a.extend(!0,this.options,b),Object.keys(b).length>0&&m(n.options)},c.prototype.login=function(c){if(m(n.options),l(c))throw new Error("username is a required parameter");var d,e=a.Deferred(),f=(new Date).getTime().toString();if(l(this.options.HashkeyProxy)){d=b.MD5(c+"&"+f+"&"+this.options.sharedsecret).toString();var g="username="+c+"&hashkey="+d+"&timestamp="+f,h={async:!0,crossDomain:!0,url:"https://"+this.options.hostname+this.options.loginpath,method:"POST",headers:{accept:"application/json","RAPI-version":this.options.RAPIVersion},processData:!1,data:g};a.ajax(h).done(function(a,b,c){j(a,b,c,e)}).fail(function(a,b,c){k(a,b,c,e)})}else{var i={async:!0,crossDomain:!0,url:this.options.HashkeyProxy,method:"POST",headers:{accept:"application/json"},processData:!1,data:JSON.stringify({username:c,timestamp:f,hostname:this.options.hostname})};a.ajax(i).done(function(a){d=a.hashkey}).fail(function(a,b,c){k(a,b,c,e)}).then(function(){var b="username="+c+"&hashkey="+d+"&timestamp="+f,g={async:!0,crossDomain:!0,url:"https://"+n.options.hostname+n.options.loginpath,method:"POST",headers:{accept:"application/json","RAPI-version":n.options.RAPIVersion},processData:!1,data:b};a.ajax(g).done(function(a,b,c){j(a,b,c,e)}).fail(function(a,b,c){k(a,b,c,e)})})}return e.promise()},c.prototype.logout=function(b){if(l(n.options.hostname))throw new Error("hostname is a required option");if(l(b))throw new Error("rapitoken is a required parameter");var c=a.Deferred(),d={async:!0,crossDomain:!0,url:"https://"+this.options.hostname+this.options.logoutpath,method:"POST",headers:{accept:"application/json","RAPI-version":this.options.RAPIVersion,authorization:b},processData:!1,dataType:"text json",converters:{"text json":function(b){return""===b?"":a.parseJSON(b)}}};return a.ajax(d).done(function(a,b,d){j(a,b,d,c)}).fail(function(a,b,d){k(a,b,d,c)}),c.promise()},c.prototype.videoDetails=function(b,c){if(l(n.options.hostname))throw new Error("hostname is a required option");if(l(c))throw new Error("videoid is a required parameter");var d=a.Deferred(),e=this.options.videodetailspath.replace(new RegExp("{{videoid}}","g"),c.trim()),f={async:!0,crossDomain:!0,url:"https://"+this.options.hostname+e,method:"GET",headers:{accept:"application/json","RAPI-version":this.options.RAPIVersion,authorization:b},processData:!1};return a.ajax(f).done(function(a,b,c){j(a,b,c,d)}).fail(function(a,b,c){k(a,b,c,d)}),d.promise()},c.prototype.videoContentLocation=function(b,c){if(l(n.options.hostname))throw new Error("hostname is a required option");if(l(c))throw new Error("videoid is a required parameter");var d=a.Deferred(),e=this.options.videocontentlocationpath.replace(new RegExp("{{videoid}}","g"),c.trim()),f={async:!0,crossDomain:!0,url:"https://"+this.options.hostname+e,method:"GET",headers:{accept:"application/json","RAPI-version":this.options.RAPIVersion,authorization:b},processData:!1};return a.ajax(f).done(function(a,b,c){j(a,b,c,d)}).fail(function(a,b,c){k(a,b,c,d)}),d.promise()},c.prototype.getVersion=function(){return o},c}(),e.videorapi=function(a){return this.RAPIInstance?this.RAPIInstance.update(a||{}):this.RAPIInstance=new g(a||{}),this.RAPIInstance}}(jQuery,CryptoJS,window,document,window.skillsoft=window.skillsoft||{});